---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(simplercpp)
```

# simplercpp

<!-- badges: start -->
![](https://img.shields.io/badge/cool-useless-green.svg)
<!-- badges: end -->


`simplercpp` is a small demo package incorporating C++ code via `Rcpp`


## Rough comparison of `.C()`, `.Call()` and `{Rcpp}`

|                | .C()                                                   | .Call()                                                      | Rcpp                                                         |
|----------------|--------------------------------------------------------|--------------------------------------------------------------|--------------------------------------------------------------|
| Overview       | No real understanding of R objects                     | Need to understand SEXP macros & internals                   | C++ classes hide the complexity of the SEXP internals        |
| What code?     | Basic C code. Numeric calcs.                           | Complex C code. Can manipulate R objects from C              | Complex C and C++ code involving numerics and R objects      |
| Pros           | Simple to understand and use                           | Simple. No unnecessary copying.                              | Great documentation.  Wrapping of R objects very intuitive.  |
| Cons           | Too simple for most interesting things                 | Need to understand SEXP & R internals                        |                                                              |
| Cons           | Performs copying of data to call functions             |                                                              |                                                              |
| Demo R package | [{simplec}](https://github.com/coolbutuseless/simplec) | [{simplecall}](https://github.com/coolbutuseless/simplecall) | [{simplercpp}](https://github.com/coolbutuseless/simplercpp) |


## Installation

You can install from [GitHub](https://github.com/coolbutuseless/simplercpp) with:

``` r
# install.package('remotes')
remotes::install_github('coolbutuseless/simplercpp)
```

## What's in the box?

Package contains 2 C++ functions, and 2 functions in R (auto-generated by Rcpp) 
which call the C functions using Rcpp (which uses `.Call()`).

| C function                                                 | R function   |
|------------------------------------------------------------|--------------|
| `NumericVector add_rcpp(NumericVector x, NumericVector y)` | `add_rcpp(x, y)`  |
| `NumericVector mul_rcpp(NumericVector x, NumericVector y)` | `mul_rcpp(x, y)`  |



## What's in the R functions?

* The R functions are auto-created by Rcpp into `R/RcppExports.R`
* C code is called using `.Call()`

```{r eval = FALSE}
#' Add 2 numeric vectors
#'
#' @param x,y numeric vectors
#'
#' @return numeric vector
#'
add_rcpp <- function(x, y) {
    .Call(`_simplercpp_add_rcpp`, x, y)
}
```


## What's in the C functions?

* Numeric vectors in R have a corresponding `NumericVector` class to use in C++
* roxygen docs on the C code get translated to roxygen docs on the auto-generated R functions
* `[[Rcpp::export]]` is used to indicate that this function should be made
  available to the package.

```
//' Add 2 numeric vectors
//'
//' @param x,y numeric vectors
//'
//' @return numeric vector
//'
// [[Rcpp::export]]
NumericVector add_rcpp(NumericVector x, NumericVector y) {
  return(x + y);
}
```




## What does the C function look like in R?

* An object of class `NativeSymbolInfo`
* Holds an `externalptr` to the loaded function

```{r}
simplercpp:::`_simplercpp_add_rcpp`
```





## Resources

* [David Vaughan's post - Now you C me](https://blog.davisvaughan.com/2019/03/02/now-you-c-me/)
* [Peter Dalgaard's Keynote from UseR 2004](http://www.ci.tuwien.ac.at/Conferences/useR-2004/Keynotes/Dalgaard.pdf) 
discusses R's language interfaces
* [Using R — Calling C Code ‘Hello World’](http://mazamascience.com/WorkingWithData/?p=1067)
* [Hadley's Advanced R book chapter - 'Rs C interface'](http://adv-r.had.co.nz/C-interface.html)
* [Rcpp](https://cran.r-project.org/package=Rcpp)

## Acknowledgements

* R Core for developing and maintaining such a wonderful language.
* CRAN maintainers, for patiently shepherding packages onto CRAN and maintaining
  the repository
